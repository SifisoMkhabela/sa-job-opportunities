<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SA Job Opportunities</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <!-- Your Custom CSS -->
  <link rel="stylesheet" href="style.css" />

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <header class="bg-light py-3 border-bottom">
    <div class="container d-flex align-items-center">
      <h1 class="ms-3 mb-0 text-dark">SA Job Opportunities</h1>
    </div>
  </header>

  <!-- Hero Section with Filters -->
  <section class="hero bg-light py-5">
    <div class="container text-center">
      <h1>Find your dream job</h1>
      <p><strong id="jobCount">Loading jobs count...</strong> Jobs in South Africa</p>

      <form class="row justify-content-center g-2" role="search" id="filterForm">
        <div class="col-md-4">
          <select name="type" id="typeSelect" class="form-select">
            <option value="">All Types</option>
          </select>
        </div>
        <div class="col-md-4">
          <select name="category" id="categorySelect" class="form-select">
            <option value="">All Categories</option>
          </select>
        </div>
        <div class="col-auto">
          <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i> Search</button>
        </div>
      </form>
    </div>
  </section>

  <!-- Job Listings -->
  <section class="container my-5">
    <div id="jobsContainer" class="row g-3">
      <p>Loading jobs...</p>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-light py-4 border-top text-center">
    <div class="container">Â© 2025 SA Job Opportunities</div>
  </footer>

  <!-- Firebase config and logic -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCexm1PTk0cst8i3NJxh8MJvqvgm0ys84A",
      authDomain: "sa-job-opportunities.firebaseapp.com",
      projectId: "sa-job-opportunities",
      storageBucket: "sa-job-opportunities.appspot.com",
      messagingSenderId: "1055979762474",
      appId: "1:1055979762474:web:54ea80e0f1e2e339793f5a",
      measurementId: "G-T1Z3MRRX2H"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Load job count
    function loadJobCount() {
      const jobCountElem = document.getElementById('jobCount');
      db.collection('jobs').get().then(snapshot => {
        jobCountElem.textContent = `${snapshot.size}+`;
      });
    }

    // Load dropdowns dynamically
    function populateDropdown(collection, selectId) {
      const select = document.getElementById(selectId);
      db.collection(collection).orderBy('name').get().then(snapshot => {
        snapshot.forEach(doc => {
          const data = doc.data();
          const option = document.createElement('option');
          option.value = data.name;
          option.textContent = data.name;
          select.appendChild(option);
        });
      });
    }

    // Fetch jobs with optional filters
    function fetchJobs(type = '', category = '') {
      const container = document.getElementById('jobsContainer');
      container.innerHTML = 'Loading jobs...';

      let query = db.collection('jobs').orderBy('deadline', 'desc');

      if (type) query = query.where('type', '==', type);
      if (category) query = query.where('category', '==', category);

      query.get().then(snapshot => {
        if (snapshot.empty) {
          container.innerHTML = '<p>No jobs found.</p>';
          return;
        }

        container.innerHTML = '';
        snapshot.forEach(doc => {
          const job = doc.data();
          const card = document.createElement('div');
          card.className = 'col-md-6 col-lg-4';
          card.innerHTML = `
            <div class="card h-100 shadow-sm">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">${job.title || 'No title'}</h5>
                <p class="card-subtitle mb-2 text-muted">${job.company || 'Unknown Company'}</p>
                <p class="card-text"><strong>Type:</strong> ${job.type || 'N/A'}</p>
                <p class="card-text"><strong>Category:</strong> ${job.category || 'N/A'}</p>
                <p class="card-text"><strong>Location:</strong> ${job.location || 'N/A'}</p>
                <p class="card-text"><strong>Deadline:</strong> ${
                  job.deadline ? new Date(job.deadline.seconds * 1000).toLocaleDateString() : 'N/A'
                }</p>
                <a href="${job.link || '#'}" class="btn btn-primary mt-auto" target="_blank">View Job</a>
              </div>
            </div>
          `;
          container.appendChild(card);
        });
      });
    }

    // On page load
    window.addEventListener('DOMContentLoaded', () => {
      loadJobCount();
      populateDropdown('types', 'typeSelect');
      populateDropdown('categories', 'categorySelect');

      // Check for filter params
      const params = new URLSearchParams(window.location.search);
      const type = params.get('type') || '';
      const category = params.get('category') || '';

      if (type) document.getElementById('typeSelect').value = type;
      if (category) document.getElementById('categorySelect').value = category;

      fetchJobs(type, category);

      // Form submit
      document.getElementById('filterForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const selectedType = document.getElementById('typeSelect').value;
        const selectedCategory = document.getElementById('categorySelect').value;
        const queryParams = new URLSearchParams();
        if (selectedType) queryParams.append('type', selectedType);
        if (selectedCategory) queryParams.append('category', selectedCategory);
        window.location.href = `index.html?${queryParams.toString()}`;
      });
    });
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


