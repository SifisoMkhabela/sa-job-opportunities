<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SA Job Opportunities</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body {
      background-color: #f8f9fa;
    }

    /* Sidebar styling */
    #sidebar {
      min-width: 220px;
      max-width: 220px;
      background: #0d6efd;
      color: white;
      min-height: 100vh;
      position: fixed;
      top: 56px; /* header height */
      left: 0;
      overflow-y: auto;
      padding-top: 1rem;
      transition: all 0.3s;
    }
    #sidebar .nav-link {
      color: white;
      font-weight: 500;
    }
    #sidebar .nav-link:hover {
      background: rgba(255, 255, 255, 0.15);
      color: #fff;
    }

    /* Main content margin to avoid sidebar overlap */
    #content {
      margin-left: 220px;
      padding: 2rem 1.5rem 3rem;
      min-height: calc(100vh - 112px); /* viewport minus header/footer */
    }

    /* Header */
    header {
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1030;
      height: 56px;
      line-height: 56px;
    }

    /* Footer */
    footer {
      margin-top: 40px;
      padding: 20px 0;
      background-color: #343a40;
      color: white;
      text-align: center;
      flex-shrink: 0;
    }

    /* Job cards styling */
    .job-card {
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      border-radius: 8px;
      transition: transform 0.2s ease;
      background-color: white;
    }
    .job-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }
    .job-type {
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      padding: 3px 8px;
      border-radius: 15px;
      background-color: #0d6efd;
      color: white;
    }
    .deadline {
      font-size: 0.9rem;
      font-weight: 500;
      color: #dc3545;
    }

    /* Logo in header */
    .navbar-brand img {
      height: 36px;
      margin-right: 10px;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      #sidebar {
        position: fixed;
        left: -220px;
        top: 56px;
        height: calc(100vh - 56px);
        transition: all 0.3s;
        z-index: 1040;
      }
      #sidebar.active {
        left: 0;
      }
      #content {
        margin-left: 0;
        padding: 2rem 1rem 3rem;
      }
      #sidebarCollapse {
        display: inline-block;
      }
    }

    #sidebarCollapse {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      display: none;
      margin-right: 15px;
    }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">

  <!-- Header/Navbar -->
  <header class="navbar navbar-dark bg-primary px-3 d-flex align-items-center">
    <button id="sidebarCollapse" aria-label="Toggle sidebar">&#9776;</button>
    <a href="#" class="navbar-brand d-flex align-items-center">
      <img src="your-logo.png" alt="SA Job Opportunities Logo" />
      <span>SA Job Opportunities</span>
    </a>
  </header>

  <!-- Sidebar -->
  <nav id="sidebar" class="bg-primary">
    <ul class="nav flex-column px-2">
      <li class="nav-item mb-2">
        <a class="nav-link active" href="#">Home</a>
      </li>
      <li class="nav-item mb-2">
        <a class="nav-link" href="#">Job Listings</a>
      </li>
      <li class="nav-item mb-2">
        <a class="nav-link" href="#">Companies</a>
      </li>
      <li class="nav-item mb-2">
        <a class="nav-link" href="#">About</a>
      </li>
      <li class="nav-item mb-2">
        <a class="nav-link" href="#">Contact</a>
      </li>
    </ul>
  </nav>

  <!-- Main content -->
  <main id="content" class="flex-grow-1">
    <div id="jobsList" class="row gy-4">
      <!-- Job cards will be inserted here -->
    </div>

    <div id="loading" class="text-center my-5">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-3">Loading jobs...</p>
    </div>

    <div id="noJobs" class="alert alert-info text-center" style="display:none;">
      No jobs available at the moment. Please check back later.
    </div>

    <div id="error" class="alert alert-danger text-center" style="display:none;">
      Error loading jobs. Please try again later.
    </div>
  </main>

  <!-- Footer -->
  <footer>
    &copy; 2025 SA Job Opportunities | All rights reserved.
  </footer>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // Sidebar toggle on small screens
    const sidebar = document.getElementById('sidebar');
    const sidebarCollapseBtn = document.getElementById('sidebarCollapse');
    sidebarCollapseBtn.addEventListener('click', () => {
      sidebar.classList.toggle('active');
    });

    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCexm1PTk0cst8i3NJxh8MJvqvgm0ys84A",
      authDomain: "sa-job-opportunities.firebaseapp.com",
      projectId: "sa-job-opportunities",
      storageBucket: "sa-job-opportunities.appspot.com",
      messagingSenderId: "1055979762474",
      appId: "1:1055979762474:web:54ea80e0f1e2e339793f5a",
      measurementId: "G-T1Z3MRRX2H"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const jobsList = document.getElementById('jobsList');
    const loading = document.getElementById('loading');
    const noJobs = document.getElementById('noJobs');
    const error = document.getElementById('error');

    function formatDate(dateStr) {
      const options = { year: 'numeric', month: 'short', day: 'numeric' };
      return new Date(dateStr).toLocaleDateString(undefined, options);
    }

    function createJobCard(job) {
      const deadlineFormatted = formatDate(job.deadline);

      return `
        <div class="col-md-6 col-lg-4">
          <div class="job-card p-4 h-100 d-flex flex-column">
            <div class="mb-2 d-flex justify-content-between align-items-center">
              <h5 class="mb-0">${job.title}</h5>
              <span class="job-type">${job.type}</span>
            </div>
            <p class="mb-1"><strong>Company:</strong> ${job.company}</p>
            ${job.location ? `<p class="mb-1"><strong>Location:</strong> ${job.location}</p>` : ''}
            <p class="mb-2 deadline">Deadline: ${deadlineFormatted}</p>
            <a href="${job.link}" target="_blank" rel="noopener noreferrer" class="btn btn-primary mt-auto">Apply Now</a>
          </div>
        </div>
      `;
    }

    async function fetchJobs() {
      try {
        const snapshot = await db.collection('jobs').orderBy('deadline').get();
        loading.style.display = 'none';

        if (snapshot.empty) {
          noJobs.style.display = 'block';
          return;
        }

        snapshot.forEach(doc => {
          const jobData = doc.data();
          jobsList.insertAdjacentHTML('beforeend', createJobCard(jobData));
        });
      } catch (err) {
        console.error('Error fetching jobs:', err);
        loading.style.display = 'none';
        error.style.display = 'block';
      }
    }

    fetchJobs();
  </script>
</body>
</html>
