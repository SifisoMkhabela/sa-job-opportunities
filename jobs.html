<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jobs - SA Job Opportunities</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="index.html">SA Job Opportunities</a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="navbarNav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              Menu
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="index.html">Home</a></li>
              <li><a class="dropdown-item" href="jobs.html">Jobs (Filter)</a></li>
            </ul>
          </li>
          <li class="nav-item"><a class="nav-link" href="company.html">Companies</a></li>
          <li class="nav-item"><a class="nav-link" href="courses.html">Courses</a></li>
          <li class="nav-item"><a class="nav-link" href="career-advice.html">Career Advice</a></li>
          <li class="nav-item"><a class="nav-link" href="post-job.html">Post a Job</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-5">
    <h1>Job Listings</h1>

    <form id="filter-form" class="row g-3 mb-4">
      <div class="col-md-4">
        <input
          type="text"
          id="filter-keyword"
          class="form-control"
          placeholder="Job Title, Skill or Company"
          autocomplete="off"
        />
      </div>
      <div class="col-md-3">
        <input
          type="text"
          id="filter-location"
          class="form-control"
          placeholder="Location"
          autocomplete="off"
        />
      </div>
      <div class="col-md-3">
        <select id="filter-category" class="form-select">
          <option value="">All Categories</option>
          <option value="IT">IT</option>
          <option value="Finance">Finance</option>
          <option value="Sales">Sales</option>
          <option value="Engineering">Engineering</option>
          <option value="Manufacturing">Manufacturing</option>
          <option value="General">General</option>
          <option value="Accounting">Accounting</option>
          <option value="Insurance">Insurance</option>
          <option value="Admin">Admin</option>
        </select>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Filter</button>
      </div>
    </form>

    <div id="jobs-list" class="list-group">
      <div class="text-center text-muted">Loading jobs...</div>
    </div>
  </main>

  <footer class="bg-dark text-white py-4 mt-5">
    <div class="container text-center">&copy; 2025 SA Job Opportunities. All rights reserved.</div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Your Firebase config should be in this file -->
  <script src="js/firebase-config.js"></script>

  <script>
    // Wait for Firebase to initialize
    document.addEventListener('DOMContentLoaded', () => {
      const jobsList = document.getElementById('jobs-list');
      const filterForm = document.getElementById('filter-form');
      const keywordInput = document.getElementById('filter-keyword');
      const locationInput = document.getElementById('filter-location');
      const categorySelect = document.getElementById('filter-category');

      let allJobs = [];

      // Render job card function
      function renderJob(jobData) {
        const card = document.createElement('div');
        card.className = 'list-group-item list-group-item-action flex-column align-items-start mb-3';

        card.innerHTML = `
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">${jobData.title}</h5>
            <small>${jobData.postedDate || ''}</small>
          </div>
          <p class="mb-1">${jobData.company} â€” ${jobData.location}</p>
          <small>Job Type: ${jobData.type} | ${jobData.daysLeft ? jobData.daysLeft + ' days left' : ''}</small>
          <div class="mt-2">
            <a href="${jobData.link || '#'}" target="_blank" class="btn btn-sm btn-primary">Apply Now</a>
          </div>
        `;

        return card;
      }

      // Display jobs on the page
      function displayJobs(jobs) {
        jobsList.innerHTML = '';
        if (jobs.length === 0) {
          jobsList.innerHTML = '<div class="text-center text-muted">No jobs found.</div>';
          return;
        }
        jobs.forEach(job => {
          jobsList.appendChild(renderJob(job));
        });
      }

      // Filter jobs by keyword, location, category
      function filterJobs() {
        const keyword = keywordInput.value.trim().toLowerCase();
        const location = locationInput.value.trim().toLowerCase();
        const category = categorySelect.value;

        const filtered = allJobs.filter(job => {
          const matchesKeyword =
            keyword === '' ||
            job.title.toLowerCase().includes(keyword) ||
            job.company.toLowerCase().includes(keyword);

          const matchesLocation =
            location === '' || (job.location && job.location.toLowerCase().includes(location));

          const matchesCategory =
            category === '' || (job.category && job.category === category);

          return matchesKeyword && matchesLocation && matchesCategory;
        });

        displayJobs(filtered);
      }

      // Load jobs from Firebase
      function loadJobs() {
        const db = firebase.firestore();

        db.collection('jobs')
          .get()
          .then(snapshot => {
            allJobs = [];
            snapshot.forEach(doc => {
              const job = doc.data();

              // Optional: compute days left if you have deadline dates stored
              const postedDate = job.postedDate || '';
              const deadline = job.deadline ? new Date(job.deadline) : null;
              let daysLeft = '';
              if (deadline) {
                const now = new Date();
                const diffTime = deadline - now;
                daysLeft = diffTime > 0 ? Math.ceil(diffTime / (1000 * 60 * 60 * 24)) : 0;
              }

              allJobs.push({
                title: job.title || 'No title',
                company: job.company || 'No company',
                location: job.location || 'No location',
                type: job.type || 'N/A',
                postedDate: postedDate,
                daysLeft: daysLeft,
                link: job.link || '#',
                category: job.category || ''
              });
            });

            displayJobs(allJobs);
          })
          .catch(error => {
            console.error('Error fetching jobs:', error);
            jobsList.innerHTML =
              '<div class="text-center text-danger">Failed to load jobs. Please try again later.</div>';
          });
      }

      // Event listener for filter form
      filterForm.addEventListener('submit', e => {
        e.preventDefault();
        filterJobs();
      });

      // Load jobs initially
      loadJobs();
    });
  </script>
</body>
</html>
