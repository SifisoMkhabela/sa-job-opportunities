<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Job Input with Description Editor</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  
  <!-- Quill CSS & JS -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  
  <style>
    #descriptionEditor {
      height: 150px;
      background: white;
    }
  </style>
</head>
<body>

<h2>Admin Login</h2>
<form id="loginForm">
  <label>Username: <input type="text" id="username" required /></label><br/><br/>
  <label>Password: <input type="password" id="password" required /></label><br/><br/>
  <button type="submit">Login</button>
  <div id="loginError" style="color:red; display:none;">Invalid credentials</div>
</form>

<div id="jobFormSection" style="display:none;">
  <h3>Post a New Job</h3>
  <form id="jobForm">
    <label>Job Title: <input type="text" id="title" required /></label><br/><br/>
    <label>Company: <input type="text" id="company" required /></label><br/><br/>
    <label>Type: <input type="text" id="type" required /></label><br/><br/>
    <label>Category: <input type="text" id="category" required /></label><br/><br/>
    <label>Experience: <input type="text" id="experience" /></label><br/><br/>
    <label>Location: <input type="text" id="location" /></label><br/><br/>
    <label>Deadline: <input type="date" id="deadline" required /></label><br/><br/>
    <label>Apply Link: <input type="url" id="link" required /></label><br/><br/>
    
    <label>Description:</label>
    <div id="descriptionEditor"></div>
    <br/>
    
    <button type="submit">Submit Job</button>
  </form>
  <div id="successMsg" style="color:green; display:none;">Job posted successfully!</div>
  <div id="errorMsg" style="color:red; display:none;"></div>
</div>

<script>
  // Initialize Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCexm1PTk0cst8i3NJxh8MJvqvgm0ys84A",
    authDomain: "sa-job-opportunities.firebaseapp.com",
    projectId: "sa-job-opportunities",
    storageBucket: "sa-job-opportunities.appspot.com",
    messagingSenderId: "1055979762474",
    appId: "1:1055979762474:web:54ea80e0f1e2e339793f5a",
    measurementId: "G-T1Z3MRRX2H"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Initialize Quill editor
  const quill = new Quill('#descriptionEditor', {
    theme: 'snow',
    placeholder: 'Enter the job description here...',
    modules: {
      toolbar: [
        [{ header: [1, 2, 3, false] }],
        ['bold', 'italic', 'underline', 'strike'],
        [{ list: 'ordered' }, { list: 'bullet' }],
        ['clean']
      ]
    }
  });

  // Login form handler
  document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    if (username === 'sifiso-zethu' && password === 'zethu-sifiso') {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('jobFormSection').style.display = 'block';
    } else {
      document.getElementById('loginError').style.display = 'block';
    }
  });

  // Job form handler
  document.getElementById('jobForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    // Hide previous messages
    document.getElementById('successMsg').style.display = 'none';
    document.getElementById('errorMsg').style.display = 'none';

    const title = document.getElementById('title').value.trim();
    const company = document.getElementById('company').value.trim();
    const type = document.getElementById('type').value.trim();
    const category = document.getElementById('category').value.trim();
    const experience = document.getElementById('experience').value.trim();
    const location = document.getElementById('location').value.trim();
    const deadlineValue = document.getElementById('deadline').value;
    const link = document.getElementById('link').value.trim();
    const descriptionHTML = quill.root.innerHTML;

    if (!title || !company || !type || !category || !deadlineValue || !link) {
      document.getElementById('errorMsg').textContent = 'Please fill all required fields.';
      document.getElementById('errorMsg').style.display = 'block';
      return;
    }

    const deadline = new Date(deadlineValue);

    try {
      const jobData = {
        title,
        company,
        type,
        category,
        experience,
        location,
        deadline,
        link,
        description: descriptionHTML,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      };

      await db.collection('jobs').add(jobData);

      document.getElementById('successMsg').style.display = 'block';
      this.reset();
      quill.setContents([]);

    } catch (error) {
      document.getElementById('errorMsg').textContent = 'Error: ' + error.message;
      document.getElementById('errorMsg').style.display = 'block';
    }
  });
</script>

</body>
</html>
